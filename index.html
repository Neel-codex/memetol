<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SOL Meme Finder • DexScreener + Phantom</title>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: Arial, Helvetica, sans-serif;
      background: #000000;
      color: #ffffff;
      line-height: 1.5;
    }

    h1 {
      text-align: center;
      margin: 0 0 20px;
      font-size: 2rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .status {
      text-align: center;
      color: #888;
      margin: 12px 0 20px;
      font-size: 0.95rem;
    }

    .wallet-info {
      text-align: center;
      margin: 10px 0 16px;
      color: #0f8;
      font-weight: bold;
      font-size: 1.05rem;
    }

    .btn {
      padding: 8px 14px;
      margin: 0 6px 12px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .btn-connect {
      background: #222;
      border-color: #555;
    }

    .btn-connect:hover { background: #333; }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #0a0a0a;
      border: 1px solid #222;
      font-size: 0.96rem;
    }

    th, td {
      padding: 11px 9px;
      border-bottom: 1px solid #222;
      text-align: left;
    }

    th {
      background: #111;
      color: #ccc;
      font-weight: normal;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    tr:hover {
      background: #161616;
    }

    .buy-btn {
      background: #004d33;
      color: #0f8;
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid #0c6;
      text-decoration: none;
      font-size: 0.88rem;
    }

    .buy-btn:hover {
      background: #006644;
    }

    .positive { color: #0f8; }
    .negative { color: #f44; }

    .chart-box {
      margin: 30px 0;
      border: 1px solid #222;
      background: #000;
      height: 380px;
      overflow: hidden;
      border-radius: 6px;
      position: relative;
      display: none;
    }

    .chart-box iframe {
      position: absolute;
      top: -85px;
      left: 0;
      width: 100%;
      height: 760px;
      border: none;
    }

    .alert {
      padding: 14px;
      margin: 16px 0;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
      display: none;
    }

    .alert-buy  { background: #002200; border: 2px solid #0c6; color: #0f8; }
    .alert-sell { background: #220000; border: 2px solid #f44; color: #f88; }

    /* ── Mobile responsive table ── */
    @media (max-width: 950px) {
      th:nth-child(4), td:nth-child(4),   /* Vol 24h */
      th:nth-child(8), td:nth-child(8)    /* 5m Vol */
      { display: none; }
    }

    @media (max-width: 800px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { position: absolute; top: -9999px; left: -9999px; }
      tr {
        margin-bottom: 18px;
        border: 1px solid #333;
        border-radius: 6px;
        background: #0f0f0f;
      }
      td {
        border: none;
        border-bottom: 1px solid #222;
        position: relative;
        padding-left: 48%;
        min-height: 42px;
      }
      td:before {
        position: absolute;
        top: 11px;
        left: 10px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        color: #aaa;
        content: attr(data-label);
      }
      td:last-child {
        text-align: center;
        padding: 12px;
        border-bottom: none;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>SOL Meme Finder • DexScreener</h1>

    <div class="status" id="status">Loading pairs...</div>
    <div class="wallet-info" id="walletInfo">Wallet: Not connected</div>

    <button id="connectBtn" class="btn btn-connect">Connect Phantom</button>

    <div id="buyAlert" class="alert alert-buy"></div>
    <div id="sellAlert" class="alert alert-sell"></div>

    <table>
      <thead>
        <tr>
          <th>Token</th>
          <th>Price</th>
          <th>24h %</th>
          <th>Vol 24h</th>
          <th>5m Txns</th>
          <th>5m Buy Tx</th>
          <th>5m Sell Tx</th>
          <th>5m Vol</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="pairs"></tbody>
    </table>

    <div class="chart-box" id="chartArea">
      <iframe id="dexChart" title="DexScreener Chart"></iframe>
    </div>

    <div class="status">Auto-refresh every 60 seconds</div>
  </div>

  <audio id="beep" src="https://www.soundjay.com/buttons/beep-07.mp3"></audio>

  <script>
    // ──────────────────────────────────────────────
    // Phantom + DexScreener + Buy/Sell Alerts
    // ──────────────────────────────────────────────

    const status     = document.getElementById('status');
    const walletInfo = document.getElementById('walletInfo');
    const connectBtn = document.getElementById('connectBtn');
    const pairsEl    = document.getElementById('pairs');
    const chartBox   = document.getElementById('chartArea');
    const dexChart   = document.getElementById('dexChart');
    const buyAlert   = document.getElementById('buyAlert');
    const sellAlert  = document.getElementById('sellAlert');
    const beep       = document.getElementById('beep');

    let publicKey    = null;
    let watching     = null;
    let prevBuyTx    = 0;
    let prevSellTx   = 0;
    let prevVol      = 0;
    let timer        = null;

    // Connect Phantom
    async function connectWallet() {
      if (!window.solana || !window.solana.isPhantom) {
        status.textContent = "Phantom wallet not found. Install from phantom.app";
        return;
      }

      try {
        const resp = await window.solana.connect();
        publicKey = resp.publicKey.toString();
        walletInfo.textContent = `Connected: ${publicKey.slice(0,6)}...${publicKey.slice(-4)}`;
        connectBtn.textContent = "Connected";
        connectBtn.disabled = true;
        status.textContent = "Phantom connected successfully";
      } catch (err) {
        status.textContent = "Connection failed / rejected";
        console.error(err);
      }
    }

    connectBtn.onclick = connectWallet;

    async function loadPairs() {
      status.textContent = "Loading Solana pairs...";

      try {
        const res = await fetch('https://api.dexscreener.com/latest/dex/search?q=sol');
        const data = await res.json();

        const solPairs = (data.pairs || []).filter(p =>
          p.chainId === 'solana' &&
          p.quoteToken?.symbol === 'SOL' &&
          p.fdv < 30000000
        ).slice(0, 40);

        let html = '';
        solPairs.forEach(p => {
          const price = Number(p.priceUsd || 0).toFixed(6);
          const ch24  = (p.priceChange?.h24 || 0).toFixed(1);
          const vol24 = Number(p.volume?.h24  || 0).toLocaleString();

          const tx5m   = (p.txns?.m5?.buys || 0) + (p.txns?.m5?.sells || 0);
          const buyTx  = p.txns?.m5?.buys  || 0;
          const sellTx = p.txns?.m5?.sells || 0;
          const vol5m  = Number(p.volume?.m5  || 0).toLocaleString();

          const chCls = ch24 > 0 ? 'positive' : ch24 < 0 ? 'negative' : '';

          const dsUrl = `https://dexscreener.com/solana/${p.pairAddress}`;

          html += `
            <tr>
              <td data-label="Token"><strong>${p.baseToken.symbol}</strong><br><small>${p.baseToken.name}</small></td>
              <td data-label="Price">$${price}</td>
              <td data-label="24h %" class="${chCls}">${ch24}%</td>
              <td data-label="Vol 24h">$${vol24}</td>
              <td data-label="5m Txns">${tx5m}</td>
              <td data-label="5m Buy Tx">${buyTx}</td>
              <td data-label="5m Sell Tx">${sellTx}</td>
              <td data-label="5m Vol">$${vol5m}</td>
              <td data-label="Actions">
                <a class="buy-btn" href="${dsUrl}" target="_blank">Buy</a>
                <a href="#" onclick="watchPair('${p.pairAddress}', '${p.baseToken.symbol}')">Watch</a>
              </td>
            </tr>
          `;
        });

        pairsEl.innerHTML = html || '<tr><td colspan="9" style="text-align:center;padding:40px;color:#555;">No pairs found</td></tr>';
        status.textContent = `Updated ${new Date().toLocaleTimeString()}`;
      } catch (err) {
        status.textContent = "Load failed – retrying soon...";
      }
    }

    function watchPair(addr, symbol) {
      watching = addr;
      chartBox.style.display = 'block';
      dexChart.src = `https://dexscreener.com/solana/${addr}`;
      window.scrollTo({ top: chartBox.offsetTop - 80, behavior: 'smooth' });
      status.textContent = `Watching ${symbol} – alerts active`;

      buyAlert.style.display = 'none';
      sellAlert.style.display = 'none';
      prevBuyTx = 0;
      prevSellTx = 0;
      prevVol = 0;

      if (timer) clearInterval(timer);
      checkActivity();
      timer = setInterval(checkActivity, 16000);
    }

    async function checkActivity() {
      if (!watching) return;

      try {
        const res = await fetch(`https://api.dexscreener.com/latest/dex/pairs/solana/${watching}`);
        const { pair } = await res.json();
        if (!pair) return;

        const buyTx   = pair.txns?.m5?.buys  || 0;
        const sellTx  = pair.txns?.m5?.sells || 0;
        const vol5m   = pair.volume?.m5     || 0;

        const buyDelta  = buyTx  - prevBuyTx;
        const sellDelta = sellTx - prevSellTx;
        const volDelta  = vol5m  - prevVol;

        if (buyDelta >= 8 || (volDelta > 11000 && buyTx > sellTx * 1.3)) {
          buyAlert.textContent = `BUY ALERT • ${buyDelta} new buy tx • volume ~$${Math.round(volDelta).toLocaleString()}`;
          buyAlert.style.display = 'block';
          beep.play().catch(() => {});
          setTimeout(() => buyAlert.style.display = 'none', 14000);
        }

        if (sellDelta >= 8 || (volDelta > 9000 && sellTx > buyTx * 1.3)) {
          sellAlert.textContent = `SELL ALERT • ${sellDelta} new sell tx`;
          sellAlert.style.display = 'block';
          beep.play().catch(() => {});
          setTimeout(() => sellAlert.style.display = 'none', 14000);
        }

        prevBuyTx  = buyTx;
        prevSellTx = sellTx;
        prevVol    = vol5m;
      } catch {}
    }

    // ── Start ──
    loadPairs();
    setInterval(loadPairs, 60000);
  </script>
</body>
</html>
